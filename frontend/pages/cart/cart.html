<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../../css/main.css">
    <link rel="stylesheet" href="../../css/cart.css">

    <style>
        .cart-item {
            border-bottom: 1px solid #e0e0e0;
            padding: 20px 0;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .product-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
        }

        .quantity-control {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .quantity-control button {
            width: 35px;
            height: 35px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
        }

        .price-total {
            color: #007bff;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .empty-cart {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-cart img {
            width: 200px;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .summary-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            position: sticky;
            top: 100px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .summary-row.total {
            font-size: 1.3rem;
            font-weight: bold;
            color: #007bff;
            border-top: 2px solid #dee2e6;
            padding-top: 12px;
            margin-top: 12px;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<div id="navbar"></div>

<!-- Cart Section -->
<div class="container my-5">
    <h2 class="mb-4">
        <i class="fas fa-shopping-cart"></i> Shopping Cart
    </h2>

    <div class="row">
        <!-- Cart Items (Left Side - 8 columns) -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <div id="cartContainer">
                        <!-- Cart items will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Summary (Right Side - 4 columns) -->
        <div class="col-lg-4">
            <div class="summary-card">
                <h5 class="mb-3">
                    <i class="fas fa-receipt"></i> Order Summary
                </h5>

                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotalDisplay">₹0</span>
                </div>

                <div class="summary-row">
                    <span>Items:</span>
                    <span id="itemCountDisplay">0</span>
                </div>

                <div class="summary-row">
                    <span>Discount:</span>
                    <span class="text-success" id="discountDisplay">₹0</span>
                </div>

                <div class="summary-row">
                    <span>Delivery:</span>
                    <span class="text-success">FREE</span>
                </div>

                <div class="summary-row total">
                    <span>Total:</span>
                    <span id="totalDisplay">₹0</span>
                </div>

                <button class="btn btn-primary w-100 btn-lg mt-3" id="checkoutBtn" onclick="goToCheckout()">
                    <i class="fas fa-credit-card"></i> Proceed to Checkout
                </button>

                <a href="../../pages/product/product_list.html" class="btn btn-outline-secondary w-100 mt-2">
                    <i class="fas fa-shopping-bag"></i> Continue Shopping
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div id="footer"></div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- Main JS (loads navbar & footer) -->
<script src="../../js/main.js"></script>

<!-- Cart JS -->
<script src="../../js/cart.js"></script>

<script>
    // ============================================
    // INITIALIZE CART ON PAGE LOAD
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
        displayCart();
    });

    // ============================================
    // DISPLAY CART ITEMS
    // ============================================
    function displayCart() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartContainer = document.getElementById('cartContainer');

        if (cart.length === 0) {
            cartContainer.innerHTML = `
                <div class="empty-cart">
                    <div style="font-size: 60px; margin-bottom: 20px;">
                        <i class="fas fa-inbox" style="color: #ccc;"></i>
                    </div>
                    <h4>Your cart is empty</h4>
                    <p class="text-muted mb-4">Add some products to get started!</p>
                    <a href="../../pages/product/product_list.html" class="btn btn-primary">
                        Continue Shopping
                    </a>
                </div>
            `;
            document.getElementById('checkoutBtn').disabled = true;
            updateSummary([]);
            return;
        }

        // Generate HTML for all cart items
        let html = '';
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            html += `
                <div class="cart-item">
                    <div class="row align-items-center">
                        <!-- Product Image -->
                        <div class="col-md-2">
                            <img src="${item.image || '/assets/images/placeholder.jpg'}" 
                                 alt="${item.name}" 
                                 class="product-image">
                        </div>

                        <!-- Product Details -->
                        <div class="col-md-4">
                            <h6 class="mb-2">${item.name}</h6>
                            <p class="text-muted small mb-0">SKU: #${item.id}</p>
                            <p class="text-primary fw-bold mt-2">₹${item.price.toLocaleString()}</p>
                        </div>

                        <!-- Quantity Control -->
                        <div class="col-md-3">
                            <div class="quantity-control">
                                <button class="btn btn-sm btn-outline-secondary" 
                                        onclick="updateQuantity(${index}, -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <input type="number" value="${item.quantity}" 
                                       class="form-control form-control-sm" 
                                       readonly>
                                <button class="btn btn-sm btn-outline-secondary" 
                                        onclick="updateQuantity(${index}, 1)">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Item Total -->
                        <div class="col-md-2 text-end">
                            <p class="price-total mb-3">₹${itemTotal.toLocaleString()}</p>
                            <button class="btn btn-sm btn-danger" onclick="removeItem(${index})">
                                <i class="fas fa-trash"></i> Remove
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });

        cartContainer.innerHTML = html;
        updateSummary(cart);
        document.getElementById('checkoutBtn').disabled = false;
    }

    // ============================================
    // UPDATE QUANTITY
    // ============================================
    function updateQuantity(index, change) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        if (cart[index]) {
            const newQty = cart[index].quantity + change;
            
            if (newQty < 1) {
                removeItem(index);
                return;
            }
            
            cart[index].quantity = newQty;
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }
    }

    // ============================================
    // REMOVE ITEM FROM CART
    // ============================================
    function removeItem(index) {
        if (confirm('Remove this item from cart?')) {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            displayCart();
        }
    }

    // ============================================
    // UPDATE SUMMARY (TOTALS)
    // ============================================
    function updateSummary(cart) {
        let subtotal = 0;
        let itemCount = 0;

        cart.forEach(item => {
            subtotal += item.price * item.quantity;
            itemCount += item.quantity;
        });

        const discount = 0; // Can add coupon logic later
        const delivery = 0; // Free delivery
        const total = subtotal - discount + delivery;

        document.getElementById('subtotalDisplay').textContent = '₹' + subtotal.toLocaleString();
        document.getElementById('itemCountDisplay').textContent = itemCount;
        document.getElementById('discountDisplay').textContent = '₹' + discount.toLocaleString();
        document.getElementById('totalDisplay').textContent = '₹' + total.toLocaleString();
    }

    // ============================================
    // GO TO CHECKOUT
    // ============================================
    function goToCheckout() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
            alert('Your cart is empty!');
            return;
        }
        window.location.href = 'checkout.html';
    }
</script>

</body>
</html>